{% extends 'core/base.html' %}

{% block content %}

<h3>Exam Session: {{session.name}}</h3>
<p>{{session.description}}</p>
<h4>STATUS: {{session.get_status}}</h4>
<h5>Subject: {{session.subject}}</h5>

<a class="btn btn-success" href="{% url 'teacher-subject' session.subject.pk %}">Go to the Subject</a>
  

{% if session.get_status == 'MISSING CONFIGURATION' %}
<div class="card bg-dark text-white">
    <div class="card-header">SESSION IS MISSING CONFIGURATION SETTINGS</div>
      <div class="card-body">
    <h6>Your exam session is not fully configurated, proceed to finish with the configuration:</h6>
    <a class="btn btn-success" href="{% url 'teacher-edit-settings-session' session.id %}">Configure settings for this session</a>
    </div>
</div>

{% elif session.get_status == 'READY' %}

<div class="card bg-dark text-white">
    <div class="card-header">STUDENTS REGISTERED TO THIS SESSION: {{session.get_students_registered}}</div>
      <div class="card-body">
    <h6>You can add a student to the Exam Session manually or loading a .csv file:</h6>
    <a class="btn btn-success" href="{% url 'teacher-all-students' session.id %}">Show all registered Students</a>
    </div>
</div>

<div class="card bg-dark text-white">
    <div class="card-header">EDIT SESSION SETTINGS</div>
      <div class="card-body">
    <h6>You can edit the settings of a Session:</h6>
    <a class="btn btn-warning" href="{% url 'teacher-edit-settings-session' session.id %}">Edit General Settings</a>
    <a class="btn btn-warning" href="{% url 'teacher-edit-session' session.id %}">Edit All Settings</a>
    <a class="btn btn-danger" href="{% url 'teacher-delete-session' session.id %}">DELETE THIS SESSION</a>
    </div>
</div>

<div class="card bg-dark text-white">
  <div class="card-header">GENERATE EXAMS (cannot go back later)</div>
    <div class="card-body">
  <h6>Here you can generate the exams, before doing this check if all the settings are good before proceding.</h6>
  <h6>Number of Questions: {{session.number_of_questions}}</h6>
  <h6>Overall Difficulty: TODO</h6>
  <h6>Start Datetime: {{session.start_datetime}}</h6>
  <h6>Expiration Datetime: {{session.expiration_datetime}}</h6>
  <h6>Weight For Correct Answer: {{session.weight_correct_answer}}</h6>
  <h6>Weight For Blank Answer: {{session.weight_blank_answer}}</h6>
  <h6>Weight For Wrong Answer: {{session.weight_wrong_answer}}</h6>
  <h6>Students registered: {{session.get_students_registered}}</h6>
  <a class="btn btn-danger" href="{% url 'teacher-generate-exams-confirmation' session.id %}">GENERATE EXAMS</a>
  </div>
</div>



{% elif session.get_status == 'STARTED' %}

  {% if session.is_locked %}
    <h5>The Session is locked, so students cannot login, to unlock it click here</h5>
    <a class="btn btn-danger" href="{% url 'teacher-unlock-session' session.id %}">Unlock the Session</a>
  {% else %}
  <h5>The Session is NOT locked, so students can login, if you want to lock it click here</h5>
    <a class="btn btn-warning" href="{% url 'teacher-lock-session' session.id %}">Lock the Session</a>
  {% endif %}

  <h5>Started Exams: {{num_started_exams}}/{{exams.count}}</h5>
  <h5>Finished Exams: {{num_finished_exams}}/{{exams.count}}</h5>
  <a class="btn btn-success" href="{% url 'teacher-all-credentials' session.id %}">Show All Credentials</a>
  <a class="btn btn-danger" href="{% url 'teacher-terminate-session-confirmation' session.id %}">Terminate the Session</a>

<br>
<a href="#" class="btn btn-success" data-bs-toggle="collapse" data-bs-target="#collapse_exams" aria-expanded="false" aria-controls="collapse_exams">
Show Exams: {{exams.count}}</a>

<div class="collapse" id="collapse_exams">

<div class="card bg-white text-dark">
    <div class="card-header">Exams of the Session: {{students.count}}</div>
      <div class="card-body">
        <table class="table table-light table-striped">
          <thead>
            <tr>
              <th scope="col">TOKEN</th>
              <th scope="col">Student</th>
              <th scope="col">Started</th>
              <th scope="col">Finished</th>
            </tr>
          </thead>
          <tbody>
            {% for exam in exams %}
              <tr>
              <th scope="row">{{exam.token}}</a></th>
              <td>{{exam.student.last_name}} {{exam.student.first_name}}</td>
              <td>{{exam.is_started}} - {{exam.start_datetime}}</td>
              <td>{{exam.is_finished}} - {{exam.finish_datetime}}</td>
              </tr>
              {% endfor %}
          </tbody>
        </table>
      </div>
  </div>
</div>

<br>
<a href="#" class="btn btn-success" data-bs-toggle="collapse" data-bs-target="#collapse_accesses" aria-expanded="false" aria-controls="collapse_accesses">
Show Accesses: {{accesses.count}}</a>
  <div class="collapse" id="collapse_accesses">
  
    <table class="table table-light table-striped">
      <thead>
        <tr>
          <th scope="col">TOKEN</th>
          <th scope="col">Num Of Accesses</th>
          <th scope="col">Student</th>
          <th scope="col">IP</th>
          <th scope="col">Date</th>
        </tr>
      </thead>
      <tbody>
      
          {% for access in accesses %}
          <tr>
          <th scope="row">{{access.exam.token}}</a></th>
    
          <td>{{access.get_num_of_access_token}}</td>
          <td>{{access.exam.student.last_name}} {{access.exam.student.first_name}}</td>
          <td>{{access.ip}}</td>
          <td>{{access.creation_datetime}}</td>
          </tr>
          {% endfor %}
       
          
      </tbody>
    </table>

{% elif session.get_status == 'FINISHED' %}

<br>
<a class="btn btn-danger" href="{% url 'teacher-correct-exams' session.id %}">Correct Exams Again</a>
    
<br>
<a href="#" class="btn btn-success" data-bs-toggle="collapse" data-bs-target="#collapse_exams" aria-expanded="false" aria-controls="collapse_exams">
  Show Exams's Result: {{exams.count}}</a>
  
  <div class="collapse" id="collapse_exams">
  
  <div class="card bg-white text-dark">
      <div class="card-header">Exams'Result of the Session: {{students.count}}</div>
        <div class="card-body">
          <table class="table table-light table-striped">
            <thead>
              <tr>
                <th scope="col">TOKEN</th>
                <th scope="col">Student</th>
                <th scope="col">Correct Answers</th>
                <th scope="col">Blank Answers</th>
                <th scope="col">Wrong Answers</th>
                <th scope="col">Votation</th>
                <th scope="col">Finish Time</th>
              </tr>
            </thead>
            <tbody>
              {% for exam in exams %}
                <tr>
                <th scope="row">{{exam.token}}</a></th>
                <td>{{exam.student.last_name}} {{exam.student.first_name}}</td>
                <td>{{exam.correct_num}} / {{exam.session.number_of_questions}}</td>
                <td>{{exam.blank_num}} / {{exam.session.number_of_questions}}</td>
                <td>{{exam.wrong_num}} / {{exam.session.number_of_questions}}</td>
                <td>{{exam.votation}} / {{exam.session.getMaximumScore}}</td>
                <td>{{exam.finish_datetime}}</td>
                </tr>
                {% endfor %}
            </tbody>
          </table>
        </div>
    </div>
  </div>

{% endif %}

{% endblock content %}



