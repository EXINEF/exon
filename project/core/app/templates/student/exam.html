{% extends 'core/base.html' %}
{% load auth_extras %}
{% block content %}

<br>
<div class="container">
    <h4 class="text-end">{{request.user.last_name}} {{request.user.first_name}} - MAT: {{request.user.username}}</h4>
    <h6 class="text-end">Is Expired: {{exam.is_expired}}</h6>
    <div class="col-md-6 col-sm-6 col-xs-12">
        <div class="row">
            <h2>Remaining Time</h2>
            <h3><span id="hours"></span>:<span id="minutes"></span>:<span id="seconds"></h3>                     
        </div>
     </div>
  </div>

    
    <div class="row">
        <div class="col-7">
            <h3>{{main_question.question.text}}</h3>
            <h5>{{main_question.question.get_type}}</h5>
            <form action="" method="POST">
                {% csrf_token %}
                {% if main_question.question.get_type == 'SINGLE CHOICE' %}
                    {% for answer in answers_main_question %}
                        <label for="answer{{answer.id}}">{{answer.text}}</label>
                        
                        <input class="form-check-input mt-0" type="radio" id="answer{{answer.id}}" name="answer" value="{{answer.id}}" {% if main_question|has_this_answer:answer.id %} checked {% endif %} required>
                        <br>
                    {% endfor %}
                {% else %}
                    {% for answer in answers_main_question %}
                        <label for="answer{{answer.id}}">{{answer.text}}</label>
                        
                        <input class="form-check-input mt-0" type="checkbox" id="answer{{answer.id}}" name="{{answer.id}}" value="1" {% if main_question|has_this_answer:answer.id %} checked{% endif %}>
                        <br>
                    {% endfor %}
                {% endif %}
                

                <button type="submit" class="btn btn-primary">Save and go to the next</button>
            </form>
        </div>

        <div class="col-3">
            {% for q in questions %}
                {% if q.question.pk == main_question.question.pk %}
                <a href="{% url 'student-exam-question' q.pk %}" type="submit" class="btn btn-warning" >{{forloop.counter}}</a>
                {% elif q.is_answered %}
                    <a href="{% url 'student-exam-question' q.pk %}" type="submit" class="btn btn-primary" >{{forloop.counter}}</a>
                {% else %}
                    <a href="{% url 'student-exam-question' q.pk %}" type="submit" class="btn btn-secondary">{{forloop.counter}}</a>
                {% endif %}
                
            {% endfor %}
        </div>

        <div class="col-2">
            <a href="{% url 'student-confiramtion-finish-exam' %}" type="submit" class="btn btn-danger" >TERMINATE THE EXAM</a>
        </div>
    </div>
</div>

<script>
    function makeTimer() {
       var endTime=new Date({{ exam.get_expiration_time|date:"U" }} * 1000);
        endTime = (Date.parse(endTime) / 1000);
    
            var now = new Date();
            now = (Date.parse(now) / 1000);
    
            var timeLeft = endTime - now;
    
            var hours = Math.floor(timeLeft / 3600);
            var minutes = Math.floor((timeLeft - (hours * 3600 )) / 60);
            var seconds = Math.floor((timeLeft - (hours * 3600) - (minutes * 60)));

            if (hours==0 && minutes==0 && seconds==0){
                alert('TIME EXPIRED')
                window.location.reload();
            }

            if (hours < "10") { hours = "0" + hours; }
            if (minutes < "10") { minutes = "0" + minutes; }
            if (seconds < "10") { seconds = "0" + seconds; }

            $("#hours").html(hours);
            $("#minutes").html(minutes);
            $("#seconds").html(seconds);
    
    }
    
    setInterval(function() { makeTimer(); }, 1000);
    </script>
<br>

{% endblock content %}



